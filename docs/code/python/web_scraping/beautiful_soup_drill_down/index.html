<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66582-32"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66582-32');
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Drilling Down With Beautiful Soup" />
<meta property="og:description" content="Drilling Down With Beautiful Soup." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chrisalbon.com/code/python/web_scraping/beautiful_soup_drill_down/" /><meta property="og:image" content="https://chrisalbon.com/images/frontpage_twitter_card.png"/><meta property="article:section" content="code" />
<meta property="article:published_time" content="2017-12-20T11:53:49-07:00" />
<meta property="article:modified_time" content="2017-12-20T11:53:49-07:00" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://chrisalbon.com/images/frontpage_twitter_card.png"/>

<meta name="twitter:title" content="Drilling Down With Beautiful Soup"/>
<meta name="twitter:description" content="Drilling Down With Beautiful Soup."/>

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Drilling Down With Beautiful Soup",
  "url": "https:\/\/chrisalbon.com\/code\/python\/web_scraping\/beautiful_soup_drill_down\/",
  "wordCount": "700",
  "datePublished": "2017-12-20T11:53:49-07:00",
  "dateModified": "2017-12-20T11:53:49-07:00",
  "author": {
    "@type": "Person",
    "name": "Chris Albon"
  },
  "description": "Drilling Down With Beautiful Soup."
}
</script> 

    <title>Drilling Down With Beautiful Soup</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://chrisalbon.com/css/custom.css" rel="stylesheet"> 
    <link href="https://chrisalbon.com/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"> 
    
    

    
    <link href="https://chrisalbon.com//articles/index.xml" rel="alternate" type="application/rss+xml" title="Chris Albon Articles" />

    <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container">
            <a class="navbar-brand" href="https://chrisalbon.com/">Chris Albon</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="navbar-nav">



                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            Code
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_machine_learning">Machine Learning</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_deep_learning">Deep Learning</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_machine_learning_engineering">ML Engineering</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_python">Python</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_docker">Docker</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_statistics">Statistics</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_scala">Scala</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_snowflake">Snowflake</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_postgresql">PostgreSQL</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_linux">Command Line</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_regex">Regular Expressions</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_aws">AWS</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_git_and_github">Git &amp; GitHub</a>
                            <a class="dropdown-item" href="https://chrisalbon.com/#code_php">PHP</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.youtube.com/channel/UCnd4Fi-ODvuPbxR2fO2j7kA">Study With Me</a>
                    </li>



                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            About
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://chrisalbon.com/about/chris_albon/">About Chris</a>
                            <a class="dropdown-item" href="https://twitter.com/chrisalbon">Twitter</a>
                            <a class="dropdown-item" href="https://www.amazon.com/Machine-Learning-Python-Cookbook-Preprocessing/dp/1491989386">ML Book</a>
                            <a class="dropdown-item" href="https://machinelearningflashcards.com/">ML Flashcards</a>
                        </div>
                    </li>
                </ul>

                
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                 


<article>
  <div class="technical_note">
  <header>
      <div class="alert alert-primary flashcard_banner" role="alert">
        Learning machine learning with <a href="https://machinelearningflashcards.com" class="alert-link">machine learning flashcards</a>, <a href='https://amzn.to/2HwnWty' class="alert-link">Python ML book</a>, or <a href='https://www.youtube.com/channel/UCnd4Fi-ODvuPbxR2fO2j7kA' class="alert-link">study with me videos</a>.
      </div>
    <h1 class="technical_note_title">Drilling Down With Beautiful Soup</h1>
    <div class="technical_note_date">
      <time datetime=" 2017-12-20T11:53:49-07:00 "> 20 Dec 2017</time>
    </div>
  </header>
  <div class="content">
  <h2 id="preliminaries">Preliminaries</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Import required modules</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</code></pre></div><h2 id="download-the-html-and-create-a-beautiful-soup-object">Download the HTML and create a Beautiful Soup object</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Create a variable with the URL to this tutorial</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://en.wikipedia.org/wiki/List_of_A_Song_of_Ice_and_Fire_characters&#39;</span>

<span class="c1"># Scrape the HTML at the url</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Turn the HTML into a Beautiful Soup object</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&#34;lxml&#34;</span><span class="p">)</span>
</code></pre></div><p>If we looked at the soup object, we&rsquo;d see that the names we want are in a heirarchical list. In psuedo-code, it looks like:</p>
<ul>
<li>class=toclevel-1 span=toctext
<ul>
<li>class=toclevel-2 span=toctext CHARACTER NAMES</li>
<li>class=toclevel-2 span=toctext CHARACTER NAMES</li>
<li>class=toclevel-2 span=toctext CHARACTER NAMES</li>
<li>class=toclevel-2 span=toctext CHARACTER NAMES</li>
<li>class=toclevel-2 span=toctext CHARACTER NAMES</li>
</ul>
</li>
</ul>
<p>To get the CHARACTER NAMES, we are going to need to drill down to grap into loclevel-2 and grab the toctext</p>
<h2 id="setting-up-where-to-put-the-results">Setting up where to put the results</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Create a variable to score the scraped data in</span>
<span class="n">character_name</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div><h2 id="drilling-down-with-a-forloop">Drilling down with a forloop</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># for each item in all the toclevel-2 li items</span>
<span class="c1"># (except the last three because they are not character names), </span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">,{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s1">&#39;toclevel-2&#39;</span><span class="p">})[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span> 
    <span class="c1"># find each span with class=toctext,</span>
    <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s1">&#39;toctext&#39;</span><span class="p">}):</span> 
        <span class="c1"># add the stripped string of each to character_name, one by one</span>
        <span class="n">character_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div><h2 id="results">Results</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># View all the character names</span>
<span class="n">character_name</span>
</code></pre></div><pre><code>['Eddard Stark',
 'Catelyn Stark',
 'Robb Stark',
 'Sansa Stark',
 'Arya Stark',
 'Bran Stark',
 'Rickon Stark',
 'Jon Snow',
 'Benjen Stark',
 'Lyanna Stark',
 'Roose Bolton',
 'Ramsay Bolton',
 'Rickard Karstark',
 'Alys Karstark',
 'Wyman Manderly',
 'Hodor',
 'Osha',
 'Jeyne Poole',
 'Jojen and Meera Reed',
 'Jeyne Westerling',
 'Aegon V Targaryen',
 'Aerys II Targaryen',
 'Rhaegar Targaryen',
 'Viserys Targaryen',
 'Daenerys Targaryen',
 'Aegon VI Targaryen',
 'Jon Connington',
 'Jorah Mormont',
 'Brynden Rivers',
 'Missandei',
 'Daario Naharis',
 'Grey Worm',
 'Maekar I Targaryen',
 'House Blackfyre',
 'Tywin Lannister',
 'Cersei Lannister',
 'Jaime Lannister',
 'Tyrion Lannister',
 'Joffrey Baratheon',
 'Myrcella Baratheon',
 'Tommen Baratheon',
 'Kevan Lannister',
 'Lancel Lannister',
 'Bronn',
 'Gregor Clegane',
 'Sandor Clegane',
 'Podrick Payne',
 'Robert Baratheon',
 'Stannis Baratheon',
 'Selyse Florent',
 'Renly Baratheon',
 'Shireen Baratheon',
 'Melisandre',
 'Davos Seaworth',
 'Brienne of Tarth',
 'Beric Dondarrion',
 'Gendry',
 'Edric Storm',
 'Jon Arryn',
 'Lysa Arryn',
 'Robert Arryn',
 'Yohn Royce',
 'Anya Waynwood',
 'Nestor Royce',
 'Balon Greyjoy',
 'Asha Greyjoy',
 'Theon Greyjoy',
 'Euron Greyjoy',
 'Victarion Greyjoy',
 'Aeron Greyjoy',
 'Rodrik Harlaw',
 'Doran Martell',
 'Arianne Martell',
 'Quentyn Martell',
 'Trystane Martell',
 'Elia Martell',
 'Oberyn Martell',
 'Ellaria Sand',
 'The Sand Snakes',
 'Areo Hotah',
 'Hoster Tully',
 'Edmure Tully',
 'Brynden Tully',
 'Walder Frey',
 'Mace Tyrell',
 'Loras Tyrell',
 'Margaery Tyrell',
 'Olenna Tyrell',
 'Randyll Tarly',
 'Jeor Mormont',
 'Maester Aemon',
 'Yoren',
 'Samwell Tarly',
 'Janos Slynt',
 'Alliser Thorne',
 'Mance Rayder',
 'Ygritte',
 'Craster',
 'Gilly',
 'Val',
 'Lord of Bones',
 'Bowen Marsh',
 'Eddison Tollett',
 'Tormund Giantsbane',
 'Varamyr Sixskins',
 'Petyr Baelish',
 'Varys',
 'Pycelle',
 'Barristan Selmy',
 'Arys Oakheart',
 'Ilyn Payne',
 'Qyburn',
 'The High Sparrow',
 'Meryn Trant',
 'Balon Swann',
 'Khal Drogo',
 'Syrio Forel',
 &quot;Jaqen H'ghar&quot;,
 'Illyrio Mopatis',
 'Thoros of Myr',
 'Ser Duncan the Tall',
 'Hizdahr zo Loraq',
 'Yezzan zo Qaggaz',
 'Tycho Nestoris',
 'The Waif',
 'Meribald',
 'Septa Unella']
</code></pre>
<h2 id="quick-analysis-which-house-has-the-most-main-characters">Quick analysis: Which house has the most main characters?</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Create a list object where to store the for loop results</span>
<span class="n">houses</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># For each element in the character_name list,</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">character_name</span><span class="p">:</span>
    <span class="c1"># split up the names by a blank space and select the last element</span>
    <span class="c1"># this works because it is the last name if they are a house, </span>
    <span class="c1"># but the first name if they only have one name,</span>
    <span class="c1"># Then append each last name to the houses list</span>
    <span class="n">houses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Convert houses into a pandas series (so we can use value_counts())</span>
<span class="n">houses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">houses</span><span class="p">)</span>

<span class="c1"># Count the number of times each name/house name appears</span>
<span class="n">houses</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div><pre><code>Stark         9
Targaryen     7
Baratheon     7
Martell       6
Greyjoy       6
Lannister     6
Tyrell        4
Tully         3
Arryn         3
Tarly         2
Bolton        2
Mormont       2
Royce         2
Clegane       2
Payne         2
Karstark      2
Storm         1
Poole         1
Giantsbane    1
Connington    1
Snakes        1
Varys         1
Westerling    1
Rayder        1
Gilly         1
Pycelle       1
Sparrow       1
Drogo         1
Hodor         1
Worm          1
             ..
Qaggaz        1
Harlaw        1
Forel         1
Slynt         1
Manderly      1
Craster       1
Frey          1
Oakheart      1
Tarth         1
Selmy         1
Trant         1
Qyburn        1
Rivers        1
Tollett       1
Reed          1
Mopatis       1
Dondarrion    1
Florent       1
Waynwood      1
Yoren         1
Baelish       1
Osha          1
Unella        1
Bronn         1
Gendry        1
Myr           1
Thorne        1
Nestoris      1
Tall          1
H'ghar        1
Length: 78, dtype: int64
</code></pre>

</div>
  <aside>
      <div class="bug_reporting">
          <h4>Find an error or bug?</h4>
          <p>Everything on this site is available on GitHub. Head to <a href='https://github.com/chrisalbon/notes/issues/new'>and submit a change</a>.</p>
      </div>
      </aside>

    </div>
</article>




            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted"><a href="https://github.com/chrisalbon/notes/blob/master/LICENSE.txt">License</a>. All 704 notes and articles are available on <a href="https://github.com/chrisalbon/notes">GitHub</a>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>